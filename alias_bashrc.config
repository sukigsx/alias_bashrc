#!/bin/bash

#colores
#ejemplo: echo -e "${verde} La opcion (-e) es para que pille el color.${borra_colores}"

rojo="\e[0;31m\033[1m" #rojo
verde="\e[;32m\033[1m"
azul="\e[0;34m\033[1m"
amarillo="\e[0;33m\033[1m"
rosa="\e[0;35m\033[1m"
turquesa="\e[0;36m\033[1m"
borra_colores="\033[0m\e[0m" #borra colores

#esto es lo que muestra al cargar laterminal
echo -e " Opciones de alias_bashrc ( comando = opciones_alias )."



opciones_alias(){
echo ""
echo -e " ${verde}-${borra_colores} Opciones de alias_bashrc ${verde}-${borra_colores}"
echo ""
echo -e "${azul} actualizar_alias_bashrc${borra_colores}"
echo -e "${azul} desistalar_alias_bashrc${borra_colores}"
echo -e "${azul} crear_alias${borra_colores}"
echo -e "${azul} borrar_alias${borra_colores}"
echo -e "${azul} backup_alias${borra_colores}"
echo -e "${azul} restore_alias${borra_colores}"
echo -e "${azul} editar_fichero_alias${borra_colores}"
echo ""
}

#actualizar el script
actualizar_alias(){

#comprueba conexion
if ping -c1 google.com &>/dev/null
then
    conexion="SI"
    echo ""
    echo -e " Conexion a internet = ${verde}SI${borra_colores}"
else
    conexion="NO"
    echo ""
    echo -e " Conexion a internet = ${rojo}NO${borra_colores}"
    echo ""
    echo -e "${rojo} No se puede comprobar la actualizacion sin conexion a internet.${borra_colores}"
fi


archivo_local="alias_bashrc.config" # Nombre del archivo local
ruta_repositorio="https://github.com/sukigsx/alias_bashrc.git" #ruta del repositorio para actualizar y clonar con git clone

# Obtener la ruta del script
descarga="/home/$(whoami)/.config/alias_bashrc"
git clone $ruta_repositorio /tmp/comprobar >/dev/null 2>&1

diff $descarga/$archivo_local /tmp/comprobar/$archivo_local >/dev/null 2>&1


if [ $? = 0 ]
then
    #esta actualizado, solo lo comprueba
    echo ""
    echo -e " Actualizado = ${verde}SI${borra_colores}"
    echo ""
    chmod -R +w /tmp/comprobar
    rm -R /tmp/comprobar
    actualizado="SI"
else
    #hay que actualizar, comprueba y actualiza
    echo ""
    echo -e "${amarillo} EL script${borra_colores} $0 ${amarillo}NO esta actualizado.${borra_colores}"
    echo -e "${verde} Se procede a su actualizacion automatica.${borra_colores}"
    sleep 3
    mv /tmp/comprobar/$archivo_local $descarga
    chmod -R +w /tmp/comprobar
    rm -R /tmp/comprobar
    echo ""
    echo -e "${amarillo} El script se ha actualizado, es necesario reiniciar la terminal.${borra_colores}"
    echo -e ""
    read -p " Pulsa una tecla para continuar." p
    exit
fi
}


#actualizar el script
desistalar_alias_bashrc(){
while :
clear
echo ""
echo -e "${verde} - DESISTALACION -${borra_colores}"
echo ""
read -p " ¿ Desistalar alias_bashrc incluidos los alias creados (s/n)? " sn
do
case $sn in
        s|S)    #si
                #borra la carga source del .actualizar_alias_bashrc
                sed -i '/source \/home\/$(whoami)\/.config\/alias_bashrc\/alias_bashrc.config/d' /home/$(whoami)/.bashrc
                rm -r /home/$(whoami)/.config/alias_bashrc
                rm /home/$(whoami)/.bash_aliases >/dev/null 2>&1
                echo -e ""
                echo -e " Entrada source del .bashrc borrada = ${verde} SI ${borra_colores}"
                echo -e " Fichero de configuracion alias_bashrc.congig borrado = ${verde}SI${borra_colores}"
                echo -e " Alias de tu usuario $(whoami) borradas = ${verde}SI${borra_colores}"
                echo ""
                echo -e "${verde} Desistalacion completada.${borra_colores}"
                echo -e "${amarillo} Es necesario reiniciar el terminal.${borra_colores}"
                echo ""
                read -p " Pulsa una tecla o ctrl+c para salir."
                wmctrl -r :ACTIVE: -b remove,maximized_vert,maximized_horz >/dev/null 2>&1
                xdotool windowkill `xdotool getactivewindow` >/dev/null 2>&1
                echo ""
                exit
                ;;

        n|N)    #no
                echo ""
                echo -e "${verde} Perfecto, no se desistala nada.${borra_colores}"
                echo ""
                break
                ;;

        *)      echo "";
                echo -e " ${amarillo}Respuesta imbalida ( s/n ) ${borra_colores}";
                echo -e " ${amarillo}PRESIONA ENTER PARA CONTINUAR ........${borra_colores}";
                echo "";
                read pause;;

esac
done

}

#crear_alias
crear_alias(){
# Pedir al usuario el alias y el comando
echo ""
read -p " Nombre del alias: " alias_name
read -p " Comando para el alias $alias_name: " command

# Añadir el alias al archivo .bash_aliases
echo 'alias $alias_name="$command"' >> /home/$(whoami)/.bash_aliases
echo ""
echo -e " Alias creado (${verde}$alias_name=$command${borra_colores})."
echo ""
}

#borrar_alias
borrar_alias(){
#!/bin/bash

# Mostrar los aliases disponibles en .bash_aliases
echo ""
echo " Alias disponibles de $(whoami):"
echo ""
grep -oP "alias\s+\K\w+(?=\=)" /home/$(whoami)/.bash_aliases
echo ""
# Pedir al usuario los aliases que desea eliminar, separados por espacio
read -p " Introduce los aliases que quieres eliminar (separados por espacio): " aliases_to_remove

# Dividir los aliases ingresados por el usuario en un array
aliases_array=($aliases_to_remove)

# Eliminar cada alias del archivo .bash_aliases
for alias_name in "${aliases_array[@]}"; do
    sed -i "/alias $alias_name=/d" ~/.bash_aliases
    echo "Alias '$alias_name' eliminado correctamente."
done
echo ""
}
















